
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartMarkt - Promos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='promos.css') }}">
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app-container">
      <header>
        <div class="coin-container">
          <span class="coin">€</span>
          <span class="coin">€</span>
          <span class="coin">€</span>
          <span class="coin">€</span>
          <span class="coin">€</span>
          <span class="coin">€</span>
          <span class="coin">$</span>
          <span class="coin">$</span>
        </div>
        <h1>SmartMarkt</h1>
      </header>

      <main>
        <div class="promo-container">
          <div class="promo-stack">
            {% if deals %}
              {% for p1, p2, score in deals %}
              <div class="promo-card" id="promo{{ loop.index }}" style="{% if loop.index0 != 0 %}display:none;{% endif %}">
                <div class="promo-content">
                  <h2>{{ p1.naam }} + <span class="text-primary">{{ p2.naam }}</span></h2>
                  <!-- <p class="promo-description">Combo deal score: {{ score }}</p> -->
                  <div class="promo-details">
                    <span class="material-icons">local_offer</span>
                    <span>Combo aanbieding</span>
                  </div>
                  <div class="save-amount">
                    <span>Save up to 5%</span>
                    <!-- <strong>€{{ p1.prijs | default('0.00') }} + €{{ p2.prijs | default('0.00') }}</strong> -->
                  </div>
                </div>
                <div class="swipe-overlay">
                  <div class="accept">ACCEPT</div>
                  <div class="reject">SKIP</div>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <p class="text-muted mb-0">Geen combo aanbiedingen beschikbaar.</p>
            {% endif %}
          </div>

          <div class="action-buttons">
            <button class="action-button reject-button">
              <span class="material-icons">close</span>
            </button>
            <button class="action-button accept-button">
              <span class="material-icons">check</span>
            </button>
          </div>
        </div>
      </main>

      <nav class="bottom-nav">
        <a href="homepage.html" class="nav-item">
          <span class="material-icons">home</span>
          <span>Home</span>
        </a>
        <a href="promos.html" class="nav-item active">
          <span class="material-icons">local_offer</span>
          <span>Promos</span>
        </a>
        <a href="shopping.html" class="nav-item">
          <span class="material-icons">shopping_cart</span>
          <span>Shopping</span>
        </a>
        <a href="profile.html" class="nav-item">
          <span class="material-icons">person</span>
          <span>Account</span>
        </a>
      </nav>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const cards = document.querySelectorAll(".promo-card");
        let currentCard = 0;

        // If there are no promo cards, disable action buttons and stop.
        if (!cards || cards.length === 0) {
          const acceptBtn = document.querySelector(".accept-button");
          const rejectBtn = document.querySelector(".reject-button");
          if (acceptBtn) acceptBtn.disabled = true;
          if (rejectBtn) rejectBtn.disabled = true;
          return;
        }

        cards.forEach((card) => {
          let startX = 0;
          let currentX = 0;

          card.addEventListener("touchstart", (e) => {
            startX = e.touches[0].clientX;
          });

          card.addEventListener("touchmove", (e) => {
            currentX = e.touches[0].clientX - startX;
            card.style.transform = `translateX(${currentX}px) rotate(${
              currentX * 0.1
            }deg)`;
            updateOverlay(card, currentX);
          });

          card.addEventListener("touchend", (e) => {
            handleSwipeEnd(card, currentX);
          });
        });

        document
          .querySelector(".accept-button")
          .addEventListener("click", () => {
            acceptCard(cards[currentCard]);
          });

        document
          .querySelector(".reject-button")
          .addEventListener("click", () => {
            rejectCard(cards[currentCard]);
          });

        function updateOverlay(card, offset) {
          const overlay = card.querySelector(".swipe-overlay");
          if (offset > 50) {
            overlay.classList.add("accept-active");
            overlay.classList.remove("reject-active");
          } else if (offset < -50) {
            overlay.classList.add("reject-active");
            overlay.classList.remove("accept-active");
          } else {
            overlay.classList.remove("accept-active", "reject-active");
          }
        }

        function handleSwipeEnd(card, offset) {
          if (offset > 100) {
            acceptCard(card);
          } else if (offset < -100) {
            rejectCard(card);
          } else {
            resetCard(card);
          }
        }

        function acceptCard(card) {
          card.style.transform = "translateX(200%) rotate(20deg)";
          card.style.opacity = "0";
          showNextCard();
        }

        function rejectCard(card) {
          card.style.transform = "translateX(-200%) rotate(-20deg)";
          card.style.opacity = "0";
          showNextCard();
        }

        function resetCard(card) {
          card.style.transform = "translateX(0) rotate(0)";
          card
            .querySelector(".swipe-overlay")
            .classList.remove("accept-active", "reject-active");
        }

        function showNextCard() {
          setTimeout(() => {
            cards[currentCard].style.display = "none";
            currentCard = (currentCard + 1) % cards.length;
            cards[currentCard].style.display = "block";
            cards[currentCard].style.transform = "translateX(0) rotate(0)";
            cards[currentCard].style.opacity = "1";
          }, 300);
        }
      });
    </script>
  </body>
</html>



